<?php
class APIScripts extends MX_Controller {

	private $mailingList = array("romil.goel@shiksha.com", "ankur.gupta@shiksha.com", "ankit.b@shiksha.com", "abhinav.pandey@shiksha.com");

	function __construct(){

	}
	
	function reindexAllAbusedUsers(){

		$apicronmodel = $this->load->model("common_api/apicronmodel");

		$abusedUsers = array(29123,51349,63094,77253,79252,104988,128611,142658,142671,168341,170791,189880,231769,281504,282487,327145,374269,393904,397005,427936,440146,462630,474523,538067,562559,587968,588021,593683,666864,668372,672054,673560,693901,734314,751184,756198,764590,764769,767628,768311,787512,792856,802155,802758,804131,804216,811722,812888,813190,821617,822986,824658,825561,826879,827187,827196,828572,830183,838987,840188,840901,841535,842421,843797,846239,852513,852723,856840,859311,860860,861321,868379,868594,872497,875305,880717,890106,896523,908186,912346,920523,920559,921982,922246,923281,927987,928163,937224,938129,938761,938860,938892,948055,951069,952736,953842,954084,957316,962041,966141,966595,970703,972371,985672,988518,989796,991680,993048,995677,1007641,1021547,1057936,1087149,1114438,1119692,1128850,1132905,1137726,1145793,1152932,1157116,1170152,1172511,1186622,1203145,1221120,1302701,1306888,1349225,1381114,1407255,1439829,1445030,1454428,1462752,1462753,1462759,1462767,1462772,1462783,1462787,1462789,1462799,1462800,1462804,1462806,1462825,1462832,1462841,1462855,1462871,1462892,1462913,1462958,1462988,1463062,1463138,1463151,1463247,1463263,1463350,1464645,1464685,1464688,1464714,1464736,1464766,1464784,1464792,1464794,1464796,1464809,1464876,1464878,1464884,1464964,1465017,1465028,1465029,1465080,1465090,1465109,1465141,1465144,1465171,1465172,1465230,1465234,1465257,1465276,1465280,1465366,1465404,1465453,1465474,1465490,1465540,1465563,1465575,1465635,1465727,1465734,1465752,1465769,1465784,1465828,1465858,1465888,1465889,1465921,1465932,1465954,1465967,1465970,1465976,1465985,1468313,1468390,1468436,1468451,1468478,1468484,1468496,1468558,1468633,1468649,1468653,1468674,1468712,1468725,1468751,1468793,1468840,1468906,1468926,1468954,1469029,1469045,1478647,1480457,1482471,1484567,1486207,1486852,1493591,1494185,1494310,1494572,1494621,1494664,1494743,1494756,1494808,1494856,1494930,1494948,1494972,1494998,1495065,1495148,1495164,1495213,1495217,1495243,1495260,1495302,1495346,1495390,1495516,1495517,1495664,1495717,1495802,1495840,1495954,1495971,1496138,1496176,1496211,1496226,1496241,1496248,1496288,1496300,1496332,1496358,1496365,1496373,1496378,1496407,1496412,1496419,1496428,1496535,1496585,1496640,1496804,1496961,1497015,1497147,1497192,1497275,1497433,1497574,1497597,1497643,1497653,1497665,1497725,1497907,1497909,1497927,1497940,1497992,1498006,1498008,1498016,1498053,1498057,1498058,1498075,1498083,1498111,1498126,1498144,1498204,1498216,1498244,1498257,1498380,1498439,1498468,1498504,1498505,1498561,1498615,1498628,1498684,1498690,1498700,1498712,1498746,1498781,1498799,1498816,1498823,1498831,1498864,1498872,1498917,1498950,1498988,1499026,1499029,1499043,1499074,1499099,1499126,1499151,1499170,1499180,1499207,1499208,1499219,1499220,1499224,1499253,1499262,1499276,1499278,1499287,1499389,1499406,1499409,1499412,1499425,1499434,1499470,1499488,1499490,1499499,1499504,1499526,1499595,1499602,1499608,1499613,1499625,1499631,1499636,1499668,1499671,1499679,1499683,1499710,1499715,1499728,1499730,1499741,1499742,1499744,1499750,1499752,1499760,1499770,1499771,1499772,1499777,1499785,1499805,1499826,1499829,1499839,1499844,1499847,1499860,1499861,1499867,1499868,1499870,1499882,1499883,1499893,1499899,1499909,1499914,1499915,1499937,1499950,1499957,1499987,1500007,1500018,1500027,1500037,1500048,1500148,1500165,1500172,1500177,1500183,1500210,1500242,1500276,1500293,1500327,1500391,1500436,1500439,1500441,1500472,1500502,1500532,1500570,1500585,1500605,1500622,1500672,1500673,1500676,1500713,1500720,1500753,1500755,1500763,1500773,1500784,1500792,1500816,1500826,1500829,1500852,1500856,1500878,1500884,1500898,1500919,1500920,1500921,1500923,1500946,1500955,1500957,1500982,1500986,1501008,1501041,1501066,1501080,1501098,1501103,1501105,1501143,1501204,1501219,1501222,1501229,1501275,1501286,1501320,1501354,1501367,1501374,1501390,1501405,1501407,1501415,1501432,1501451,1501477,1501491,1501492,1501526,1501549,1501554,1501578,1501597,1501598,1501616,1501618,1501624,1501632,1501638,1501648,1501649,1501651,1501678,1501691,1501697,1501708,1501712,1501714,1501715,1501739,1501746,1501752,1501753,1501756,1501758,1501760,1501764,1501765,1501777,1501780,1501785,1501790,1501791,1501796,1501797,1501798,1501810,1501820,1501823,1501833,1501835,1501843,1501859,1501860,1501888,1501893,1501897,1501901,1501904,1501908,1501917,1501920,1501936,1501950,1501986,1501987,1501999,1502043,1502045,1502049,1502079,1502083,1502107,1502112,1502122,1502220,1502283,1502316,1502322,1502342,1502368,1502371,1502379,1502398,1502420,1502421,1502461,1502493,1502505,1502520,1502527,1502531,1502534,1502544,1502550,1502570,1502580,1502582,1502586,1502592,1502598,1502616,1502634,1502640,1502645,1502656,1502671,1502688,1502690,1502700,1502781,1502811,1502816,1502849,1502867,1502914,1502918,1502930,1502934,1502937,1502961,1502964,1502980,1503011,1503014,1503021,1503057,1503090,1503105,1503122,1503137,1503147,1503160,1503169,1503172,1503180,1503212,1503254,1503261,1503262,1503265,1503266,1503281,1503291,1503311,1503334,1503357,1503370,1503380,1503449,1503485,1503487,1503490,1503502,1503511,1503514,1503518,1503528,1503546,1503549,1503552,1503553,1503559,1503565,1503590,1503592,1503597,1503599,1503607,1503608,1503612,1503613,1503618,1503625,1503654,1503657,1503660,1503662,1503670,1503677,1503678,1503680,1503684,1503697,1503699,1503701,1503720,1503725,1503745,1503747,1503759,1503760,1503764,1503768,1503777,1503779,1503782,1503790,1503791,1503794,1503795,1503797,1503803,1503813,1503819,1503828,1503832,1503835,1503844,1503851,1503866,1503867,1503876,1503883,1503899,1503903,1504009,1504021,1504028,1504035,1504055,1504057,1504061,1504079,1504112,1504121,1504122,1504158,1504190,1504202,1504229,1504243,1504265,1504278,1504306,1504313,1504334,1504574,1504581,1504588,1504597,1504603,1504617,1504621,1504631,1504654,1504677,1504679,1504695,1504708,1504711,1504722,1504743,1504761,1504819,1504822,1504830,1504851,1504887,1504889,1504892,1504914,1504929,1504930,1504933,1504938,1504955,1504963,1504969,1504999,1505001,1505016,1505048,1505050,1505078,1505108,1505110,1505114,1505119,1505167,1505173,1505190,1505198,1505207,1505220,1505230,1505248,1505249,1505279,1505286,1505296,1505311,1505325,1505337,1505344,1505352,1505356,1505358,1505360,1505361,1505367,1505382,1505385,1505393,1505394,1505395,1505400,1505403,1505416,1505421,1505432,1505433,1505434,1505441,1505450,1505451,1505456,1505460,1505464,1505465,1505467,1505470,1505475,1505484,1505491,1505500,1505501,1505503,1505509,1505513,1505516,1505519,1505520,1505527,1505534,1505535,1505537,1505538,1505547,1505556,1505569,1505575,1505579,1505606,1505615,1505617,1505619,1505620,1505646,1505654,1505663,1505678,1505679,1505690,1505717,1505722,1505723,1505750,1505768,1505770,1505778,1505830,1505875,1505886,1505904,1505914,1505946,1505999,1506005,1506079,1506104,1506352,1506452,1506469,1506481,1506508,1506525,1506571,1506603,1506615,1506813,1506857,1506893,1506937,1506944,1506965,1506966,1506984,1507082,1507110,1507337,1507389,1507432,1507498,1507500,1507674,1507792,1508139,1508169,1508204,1508208,1508268,1508303,1508510,1508534,1508656,1508672,1508683,1508707,1508716,1508794,1508800,1508823,1508835,1508911,1508938,1508953,1508985,1509083,1509173,1509209,1509262,1509275,1509437,1509442,1509494,1509743,1509788,1509901,1510014,1510079,1510113,1510326,1510334,1510350,1510466,1510471,1510486,1510514,1510547,1510553,1510569,1510579,1510634,1510652,1510663,1510684,1510685,1510694,1510702,1510715,1510737,1510754,1510791,1511017,1511046,1511063,1511095,1511105,1511168,1511222,1511282,1511319,1511379,1511421,1511535,1511620,1511685,1511689,1511773,1511901,1511934,1511970,1511980,1512003,1512025,1512035,1512066,1512119,1512146,1512153,1512178,1512194,1512203,1512206,1512210,1512213,1512293,1512316,1512338,1512384,1512481,1512515,1512563,1512624,1512643,1512718,1512821,1513208,1513925,1514029,1514033,1514055,1514081,1514082,1514083,1514100,1514102,1514112,1514113,1514114,1514117,1514122,1514123,1514131,1514136,1514138,1514142,1514145,1514147,1514149,1514158,1514162,1514165,1514176,1514177,1514180,1514182,1514198,1514216,1514229,1514274,1514308,1514335,1514367,1514368,1514441,1514448,1514494,1514497,1514528,1514545,1514635,1514669,1514706,1514717,1514816,1514834,1514839,1514853,1514897,1514918,1514942,1514947,1514965,1514993,1515049,1515292,1515373,1515734,1515761,1515923,1515925,1515976,1516007,1516049,1516065,1516124,1516259,1516288,1516304,1516384,1516394,1516440,1516561,1516656,1516835,1516841,1516868,1517152,1517210,1517244,1517262,1517304,1517363,1517381,1517404,1517552,1517630,1517754,1517865,1517980,1518018,1518104,1518285,1518306,1518484,1518515,1518549,1518557,1518581,1518601,1518608,1518612,1518623,1518624,1518696,1518716,1518718,1518723,1518747,1518753,1518839,1518844,1518858,1518874,1519013,1519014,1519294,1519319,1519486,1519796,1519829,1520163,1520285,1520312,1520317,1520656,1520666,1520674,1520676,1520752,1520764,1520842,1520918,1520959,1521023,1521080,1521128,1521189,1521217,1521265,1521301,1521367,1521415,1521430,1521454,1521457,1521478,1521494,1521634,1521665,1521788,1521841,1521934,1522050,1522100,1522117,1522142,1522231,1522259,1522271,1522294,1522302,1522326,1522332,1522333,1522367,1522372,1522376,1522386,1522397,1522404,1522407,1522410,1522421,1522425,1522484,1522552,1522563,1522581,1522660,1522667,1522669,1522802,1522825,1522829,1522857,1522973,1522983,1523018,1523052,1523225,1523244,1523278,1523307,1523308,1523395,1523455,1523473,1523515,1523556,1523632,1523671,1523729,1523799,1523808,1523848,1523854,1523864,1523969,1523975,1523984,1524000,1524006,1524009,1524046,1524079,1524087,1524090,1524092,1524104,1524107,1524119,1524127,1524132,1524157,1524161,1524164,1524165,1524166,1524175,1524181,1524189,1524201,1524206,1524221,1524224,1524229,1524237,1524245,1524293,1524326,1524363,1524365,1524368,1524384,1524398,1524411,1524457,1524500,1524545,1524596,1524684,1524757,1524786,1524806,1524836,1524904,1524917,1524948,1524992,1525084,1525105,1525191,1525228,1525320,1525340,1525347,1525489,1525543,1525562,1525589,1525614,1525625,1525636,1525653,1525669,1525677,1525695,1525703,1525704,1525706,1525710,1525712,1525750,1525760,1525788,1525790,1525841,1525880,1525966,1526001,1526032,1526149,1526312,1526397,1526524,1526547,1526558,1526588,1526617,1526653,1526658,1526722,1526757,1526872,1526895,1526907,1527048,1527057,1527063,1527089,1527112,1527162,1527213,1527219,1527331,1527378,1527382,1527419,1527428,1527453,1527458,1527460,1527486,1527489,1527493,1527496,1527499,1527503,1527504,1527506,1527513,1527516,1527517,1527522,1527528,1527529,1527531,1527534,1527539,1527541,1527551,1527553,1527557,1527560,1527585,1527590,1527606,1527608,1527621,1527644,1527648,1527660,1527671,1527777,1527839,1527864,1527977,1527987,1528003,1528013,1528036,1528065,1528100,1528173,1528187,1528240,1528414,1528430,1528504,1528684,1528704,1528749,1528812,1528833,1528844,1528924,1528931,1528973,1529024,1529030,1529053,1529083,1529092,1529095,1529135,1529143,1529151,1529157,1529163,1529168,1529169,1529172,1529176,1529177,1529182,1529184,1529189,1529193,1529198,1529208,1529210,1529217,1529224,1529238,1529251,1529258,1529263,1529387,1529412,1529497,1529500,1529513,1529544,1529663,1529667,1529711,1529726,1529731,1529821,1529830,1529831,1529858,1529910,1529950,1529976,1530101,1530181,1530193,1530219,1530237,1530247,1530271,1530303,1530503,1530699,1530702,1530706,1530747,1530754,1530756,1530757,1530761,1530763,1530776,1530784,1530788,1530791,1530799,1530802,1530806,1530813,1530814,1530822,1530826,1530862,1530886,1530888,1530920,1530943,1531053,1531105,1531247,1531298,1531419,1531482,1531497,1531509,1531520,1531546,1531554,1531584,1531607,1531685,1531700,1531760,1531833,1531836,1531875,1531879,1531937,1531941,1531982,1532002,1532065,1532067,1532070,1532075,1532089,1532091,1532093,1532132,1532151,1532836,1532899,1532914,1533191,1533287,1533498,1533914,1533977,1534021,1534189,1534283,1534375,1534417,1534489,1534510,1534548,1534586,1534777,1535080,1535188,1535225,1535488,1535597,1535625,1535641,1535647,1535967,1536443,1536629,1536634,1536656,1536732,1567030,1588383,1595115,1605914,1609052,1613992,1621360,1642143,1648340,1666360,1677069,1681547,1683532,1687537,1701506,1708696,1708947,1709045,1709089,1709092,1709115,1709128,1709187,1709283,1709420,1709705,1710087,1710613,1710616,1710795,1710841,1710852,1710880,1710906,1710921,1710925,1710962,1710989,1711203,1711308,1711518,1711577,1711822,1711887,1711973,1711992,1712266,1712426,1712446,1712595,1712746,1712800,1712854,1712910,1712919,1712957,1712966,1712973,1712989,1712997,1713009,1713078,1713191,1713668,1713722,1713847,1713917,1713960,1714110,1714111,1714238,1714325,1714335,1714395,1714587,1714600,1714806,1714811,1714898,1714913,1714931,1715000,1715025,1715034,1715035,1715037,1715055,1715064,1715076,1715081,1715086,1715090,1715102,1715104,1715108,1715118,1715121,1715176,1715196,1715206,1715287,1715304,1715328,1715380,1715485,1715565,1715602,1715714,1715761,1715795,1715880,1715895,1715907,1715965,1715980,1716117,1716171,1716223,1716267,1716300,1716478,1716550,1716589,1716664,1716671,1716687,1716692,1716726,1716773,1716881,1716899,1716908,1716923,1716931,1716934,1716941,1716954,1716974,1716977,1716981,1716991,1717000,1717031,1717047,1717086,1717151,1717157,1717201,1717203,1717242,1717352,1717384,1717415,1717427,1717546,1717589,1717594,1717697,1717720,1717819,1717851,1717940,1718062,1718189,1718229,1718354,1718406,1718536,1718734,1718815,1718944,1718958,1718977,1718980,1718990,1718996,1719013,1719030,1719031,1719058,1719065,1719077,1719080,1719082,1719086,1719123,1719138,1719140,1719161,1719189,1719204,1719232,1719262,1719294,1719408,1719447,1719464,1719468,1719478,1719518,1719609,1719885,1719893,1719961,1720070,1720075,1720126,1720214,1720233,1720268,1720285,1720416,1720556,1720557,1720566,1720578,1720728,1720749,1720753,1720773,1720774,1720806,1720809,1720811,1720812,1720834,1720842,1720845,1720847,1720855,1720870,1720882,1720898,1720907,1720911,1720923,1720926,1720958,1720983,1721005,1721115,1721123,1721279,1721282,1721286,1721372,1721834,1721981,1722011,1722015,1722021,1722189,1722256,1722284,1722346,1722356,1722409,1722412,1722425,1722443,1722471,1722483,1722484,1722680,1722684,1722705,1722754,1722767,1722775,1722839,1722841,1722869,1722888,1722898,1722902,1722915,1722932,1722939,1722940,1722958,1722976,1722995,1723019,1723037,1723055,1723076,1723079,1723083,1723089,1723113,1723117,1723132,1723149,1723183,1723187,1723195,1723198,1723280,1723291,1723397,1723407,1723459,1723647,1723746,1723883,1723889,1723945,1723997,1724001,1724061,1724089,1724098,1724200,1724302,1724422,1724433,1724448,1724513,1724552,1724631,1724669,1724819,1724879,1724932,1724998,1725001,1725002,1725014,1725057,1725059,1725088,1725095,1725107,1725126,1725127,1725133,1725139,1725149,1725157,1725165,1725176,1725177,1725178,1725189,1725199,1725224,1725230,1725580,1725657,1725720,1725857,1725882,1726056,1726068,1726199,1726240,1726247,1726262,1726328,1726342,1726365,1726414,1726503,1726517,1726541,1726545,1726671,1726696,1726701,1726736,1726813,1726817,1726881,1726897,1726941,1726956,1727037,1727053,1727075,1727077,1727081,1727088,1727091,1727096,1727099,1727103,1727120,1727122,1727124,1727129,1727132,1727133,1727134,1727166,1727167,1727189,1727231,1727299,1727315,1727531,1727637,1727677,1727859,1727897,1727903,1728020,1728049,1728054,1728141,1728189,1728224,1728231,1728237,1728309,1728327,1728382,1728384,1728493,1728612,1728621,1728671,1728672,1728690,1728703,1728717,1728728,1728768,1728799,1728808,1728812,1728847,1728890,1728893,1728902,1728908,1728925,1728933,1728936,1728966,1728971,1728972,1728973,1728976,1728977,1728985,1728991,1729001,1729013,1729016,1729021,1729026,1729053,1729086,1729145,1729249,1729405,1729418,1729447,1729518,1729528,1729556,1729673,1729682,1729704,1729706,1729814,1729902,1729926,1729960,1730000,1730077,1730112,1730144,1730157,1730159,1730333,1730337,1730382,1730407,1730420,1730440,1730499,1730515,1730523,1730524,1730559,1730560,1730562,1730564,1730565,1730566,1730571,1730583,1730584,1730587,1730597,1730608,1730615,1730633,1730635,1730649,1730658,1730682,1730740,1730751,1730760,1730808,1730810,1730854,1730879,1730919,1730939,1731035,1731044,1731082,1731113,1731156,1731203,1731223,1731242,1731379,1731405,1731431,1731455,1731474,1731510,1731534,1731631,1731671,1731683,1731684,1731709,1731712,1731734,1731751,1731757,1731783,1731786,1731803,1731804,1731812,1731813,1731822,1731844,1731853,1731854,1731857,1731865,1731869,1731870,1731873,1731875,1731877,1731879,1731888,1731893,1731900,1731902,1731903,1731904,1731907,1731909,1731915,1731916,1731918,1731945,1731952,1731971,1731992,1731995,1732010,1732027,1732034,1732039,1732048,1732058,1732075,1732082,1732099,1732114,1732132,1732144,1732152,1732153,1732156,1732170,1732177,1732181,1732192,1732208,1732213,1732214,1732217,1732223,1732228,1732236,1732263,1732266,1732269,1732276,1732278,1732282,1732293,1732302,1732345,1732358,1732364,1732389,1732392,1732393,1732398,1732399,1732408,1732416,1732418,1732421,1732423,1732432,1732439,1732441,1732449,1732451,1732458,1732459,1732464,1732478,1732479,1732480,1732482,1732492,1732493,1732512,1732513,1732522,1732530,1732542,1732545,1732563,1732570,1732575,1732583,1732753,1732772,1732791,1732861,1732909,1732927,1732972,1733004,1733024,1733033,1733098,1733153,1733187,1733227,1733237,1733272,1733347,1733374,1733377,1733428,1733445,1733485,1733643,1733644,1733650,1733678,1733683,1733692,1733718,1733777,1733801,1733906,1733908,1733952,1733959,1733971,1733981,1733988,1733991,1733992,1734005,1734007,1734022,1734025,1734028,1734032,1734036,1734043,1734048,1734058,1734061,1734069,1734070,1734137,1734143,1734164,1734186,1734187,1734189,1734248,1734268,1734379,1734450,1734494,1734518,1734621,1734652,1734769,1734811,1734832,1734845,1734877,1734923,1734934,1734942,1734995,1735021,1735076,1735088,1735091,1735201,1735317,1735361,1735400,1735421,1735430,1735440,1735465,1735471,1735476,1735486,1735492,1735506,1735540,1735544,1735549,1735560,1735562,1735584,1735595,1735612,1735617,1735622,1735628,1735645,1735650,1735658,1735686,1735702,1735713,1735737,1735755,1735781,1735828,1735870,1735993,1736043,1736050,1736189,1736209,1736220,1736229,1736234,1736329,1736331,1736339,1739908,1755839,1790524,1799794,1799902,1809752,1878311,1890805,1916689,1929204,1956524,1983920,1994114,2005436,2011531,2017074,2019501,2023111,2053740,2056239,2073657,2096125,2105962,2111145,2113927,2118958,2137269,2150823,2169736,2185124,2188349,2200508,2203119,2226638,2227251,2250809,2254631,2260247,2279163,2299719,2330734,2342816,2350287,2373089,2393429,2397397,2399016,2425505,2438126,2454771,2489870,2503213,2518413,2525618,2529356,2556733,2573259,2592628,2699036,2714481,2728502,2744083,2747710,2761872,2798527,2798580,2799030,2805374,2805406,2818819,2895269,2912415,2915499,2934799,2935092,2976806,2989397,2994336,3010489,3046388,3050311,3065758,3068489,3075277,3079908,3086805,3090721,3094328,3100367,3101287,3133742,3146763,3150442,3150602,3157522,3196752,3218272,3227825,3234163,3240974,3270573,3305300,3306201,3318494,3322079,3365110,3367342,3385868,3395766,3401981,3406638,3426145,3446675,3459227,3468108,3478556,3487065,3487072,3487083,3525198,3554933,3572876,3601441,3604593,3608339,3614432,3649061,3657171,3668620,3732578,3742371,3745786,3765485,3767361,3795192,3821940,3821956,3822918,3838146,3838193,3870561,3874891,3878966,3910629,3922781,3923607,3927123,3927577,3932578,3981711,3997031,3999176,4028007,4029486,4046548,4075129,4084549,4095617,4097488,4105023,4105027,4121597,4123111,4167193,4183956,4187533,4203570,4208572,4222832,4225146,4244099,4297371,4314092,4372438,4382645,4418762,4423571,4423709,4452914,4529151,4529670,4532375,4629434,4740427,4757192,4757716,4777988,4808212,4823743,4827529,4831933,4834551,4838221,4861606,4869954,4891067,4893986,4900771,4932457,4937763,4942966,4946332,5008261,5035229,5052083,5055531,5072789,5093378,5112884,5114686,5122948,5148493,5246744,5266941,5270378,5274602,5347186);

		$apicronmodel->updateUsersAbuseFlag($abusedUsers);
		
		// make chunks of user-ids
		$abusedUsers = array_chunk($abusedUsers, 5000);

		foreach ($abusedUsers as $key=>$usersChunk) {
			error_log("reindexAllAbusedUsers: Indexing for user chunk ".($key+1)." , total chunks = ".count($abusedUsers));
			Modules::run("user/UserIndexer/indexMultipleUsers", $usersChunk);;
		}
	}

	function migrateFBUserPic(){
	
		$apicronmodel = $this->load->model("common_api/apicronmodel");
		$userIds = array();
		// $userIds = array(3197788,3209940,3423389,3463191,3487057,4093549,4270643,4945875,5045917,5249496,5269640,5283473,5284392,5287572,5328365,5347338,5366583,5378431,5400486);
		// $userIds = array(3195216,5135080,5135285,5135288,5135300,5135407);
		$users = $apicronmodel->getUserWithFBPic($userIds);

		$userCommonLib = $this->load->library("v1/UserCommonLib");
		foreach ($users as $key => $value) {

			error_log("FB PIC : ".$value['avtarimageurl']);
			$profilePic = $userCommonLib->uploadUserFBProfilePic($value['userid'], $value['avtarimageurl']);	
			$apicronmodel->updateUserProfilePic($value['userid'], $profilePic);
		}
		
	}

	function removeInactiveTagFollowers(){
                ini_set("memory_limit", '-1');
                ini_set("max_execution_time", "-1");
                $this->load->model('common/personalizationmodel');
                $this->personalizationmodel             = new personalizationmodel();
                $this->predisLibrary                    = PredisLibrary::getInstance();

        // tags with most followers
        $tags = array(118,430,409,449,55,26,355,401,372,5,7,125,117,368,952,126,54,417,212,127,348,201,386229,366,84,386297,121,336,410,3,386442,386303,392,344,155,367,335,82,207,385234,424,321,83,166306,385253,331,32,370,387255,204,386356,386379,387254,192,398,385255,173,393,386433,110,387237,337,114,187,70,385239,385247,385224,386137,340,106,120,41,824,353,385280,122,168,195,385320,69,402,354,385228,341,74,385251,113,385238,108,60,385242,85,124,112,200,351,385231,67,436,387337,345,363,385236,153,149,76,385252,418,385350,45,385300,68,385262,385230,385259,385290,349,164,188,266,387257,86,359,197,29,385244,385243,198,386174,388687,152,163,42,437,151,415,387457,323,184,327,387270,362,385245,166296,385254,387238,338,385249,384425,186995,123,384424,418501,387338,81);
        foreach($tags as $tagId){
                $tagsFollowers  = $this->predisLibrary->getMembersOfSet('tagFollowers:tag:'.$tagId);

                $inactivityOfUsers = array();
                $inactiveVisitorsIds = array();
                $userIds = array();
                $visitorIds = array();
                foreach($tagsFollowers as $userId){
                        if(ctype_digit($userId)){
                            $userIds[] = $userId;
                        }else{
                            $visitorIds[] = $userId;
                        }
                }

                $inactiveUserIds = $this->personalizationmodel->getInActiveUsersFromGivenSet($userIds,14);
                $inactiveVisitorsIds = $this->personalizationmodel->getInActiveVisitorsFromGivenSet($visitorIds, 3);

                _p("For Tag id : ".$tagId);
                _p(count($userIds));
                _p(count($visitorIds));
                _p(count($inactiveUserIds));
                _p(count($inactiveVisitorsIds));
                _p("=======");

                if(is_array($inactiveUserIds) && !empty($inactiveUserIds))
                        $this->predisLibrary->removeMembersOfSet('tagFollowers:tag:'.$tagId, $inactiveUserIds);

                if(is_array($inactiveVisitorsIds) && !empty($inactiveVisitorsIds))
                        $this->predisLibrary->removeMembersOfSet('tagFollowers:tag:'.$tagId, $inactiveVisitorsIds);
        }
    }

	
}
?>


